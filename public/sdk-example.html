<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGP SDK Integration Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
        }
        .button-group {
            margin: 20px 0;
        }
        .button-group button {
            margin-right: 10px;
            margin-bottom: 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .primary {
            background-color: #007bff;
            color: white;
        }
        .secondary {
            background-color: #6c757d;
            color: white;
        }
        .danger {
            background-color: #dc3545;
            color: white;
        }
        .iframe-container {
            min-height: 400px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: #666;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>AGP SDK Integration Examples</h1>
    <p>This page demonstrates how to use the updated AGP SDK with both iframe and popup modes.</p>

    <!-- Popup Mode Example -->
    <div class="section">
        <h2>Popup Mode</h2>
        <p>Opens AGP portal in a modal popup overlay</p>
        
        <div class="button-group">
            <button class="primary" onclick="openPopup()">Open Popup</button>
            <button class="secondary" onclick="openPopupWithCallbacks()">Open Popup with Callbacks</button>
            <button class="secondary" onclick="openPopupNoPreview()">Open Popup (Sign Only)</button>
        </div>

        <h4>Usage:</h4>
        <pre><code>// Simple popup
agp.initIframe('your-session-id', {
    mode: 'popup'
});

// Popup with custom options
agp.initIframe('your-session-id', {
    mode: 'popup',
    popupWidth: 1200,
    popupHeight: 900,
    popupTitle: 'Custom Title',
    onMessage: (data, origin, iframe) => console.log('Message:', data),
    onClose: () => console.log('Popup closed')
});

// Popup with no preview (sign button only)
agp.initIframe('your-session-id', {
    mode: 'popup',
    noPreview: true,
    popupTitle: 'Sign Document',
    popupWidth: 500,
    popupHeight: 600
});</code></pre>
    </div>

    <!-- Iframe Mode with Parent Element -->
    <div class="section">
        <h2>Iframe Mode with Parent Element</h2>
        <p>Embeds AGP portal as an iframe within a specific container</p>
        
        <div class="button-group">
            <button class="primary" onclick="embedInContainer()">Embed in Container</button>
            <button class="secondary" onclick="embedNoPreview()">Embed (Sign Only)</button>
            <button class="danger" onclick="clearContainer()">Clear Container</button>
        </div>

        <div id="agp-container" class="iframe-container">
            <p>Container for AGP iframe - click "Embed in Container" to load</p>
        </div>

        <h4>Usage:</h4>
        <pre><code>// Embed in specific element
agp.initIframe('your-session-id', {
    mode: 'iframe',
    parentElement: '#agp-container', // or document.getElementById('agp-container')
    width: '100%',
    height: '600px'
});

// Embed with no preview (sign button only)
agp.initIframe('your-session-id', {
    mode: 'iframe',
    parentElement: '#agp-container',
    noPreview: true,
    height: '500px' // Smaller height for sign-only mode
});</code></pre>
    </div>

    <!-- Advanced Usage -->
    <div class="section">
        <h2>Advanced Usage</h2>
        
        <div class="button-group">
            <button class="danger" onclick="destroyAll()">Destroy All Instances</button>
        </div>

        <h4>Available Options:</h4>
        <pre><code>agp.initIframe('session-id', {
    mode: 'iframe' | 'popup',           // Integration mode
    parentElement: '#selector' | element, // Parent element for iframe mode
    noPreview: false,                   // Set to true to show only sign button
    width: '100%',                      // iframe width
    height: '800px',                    // iframe height
    border: 'solid 1px #ccc',          // iframe border
    baseUrl: 'http://localhost:3000',   // AGP base URL
    popupWidth: 800,                    // Popup width in pixels
    popupHeight: 600,                   // Popup height in pixels
    popupTitle: 'AGP Portal',           // Popup title
    onMessage: function(data, origin, iframe) {}, // Message handler
    onClose: function() {}              // Close handler (popup only)
});</code></pre>

        <h4>Return Value:</h4>
        <pre><code>// Iframe mode returns:
{
    iframe: HTMLIFrameElement,
    destroy: function() // Remove iframe
}

// Popup mode returns:
{
    popup: HTMLDivElement,
    iframe: HTMLIFrameElement,
    close: function(), // Close popup
    destroy: function() // Same as close
}</code></pre>
    </div>

    <script src="sdk.js"></script>
    <script>
        let currentInstance = null;

        function openPopup() {
            const sessionId = "f512e1e4-9119-4b6e-a55e-5f3c40b1ae25"
            currentInstance = agp.initIframe(sessionId, {
                mode: 'popup',
                popupWidth: 1200,
                popupHeight: 900
            });
        }

        function openPopupWithCallbacks() {
            const sessionId = "f512e1e4-9119-4b6e-a55e-5f3c40b1ae25"
            currentInstance = agp.initIframe(sessionId, {
                mode: 'popup',
                popupWidth: 1200,
                popupHeight: 900,
                popupTitle: 'AGP Portal - Custom',
                onMessage: (data, origin, iframe) => {
                    console.log('Custom message handler:', data);
                    // You can handle specific messages here
                },
                onClose: () => {
                    console.log('Popup was closed');
                    currentInstance = null;
                }
            });
        }

        function openPopupNoPreview() {
            const sessionId = "f512e1e4-9119-4b6e-a55e-5f3c40b1ae25"
            currentInstance = agp.initIframe(sessionId, {
                mode: 'popup',
                noPreview: true,
                popupTitle: 'Sign Document',
                popupWidth: 500,
                popupHeight: 600,
                onMessage: (data, origin, iframe) => {
                    console.log('Sign-only popup message:', data);
                },
                onClose: () => {
                    console.log('Sign-only popup was closed');
                    currentInstance = null;
                }
            });
        }

        function embedInContainer() {
            clearContainer();
            const sessionId = "f512e1e4-9119-4b6e-a55e-5f3c40b1ae25"
            currentInstance = agp.initIframe(sessionId, {
                mode: 'iframe',
                parentElement: '#agp-container',
                height: '500px',
                onMessage: (data, origin, iframe) => {
                    console.log('Iframe message:', data);
                }
            });
        }

        function embedInBody() {
            const sessionId = "f512e1e4-9119-4b6e-a55e-5f3c40b1ae25"
            currentInstance = agp.initIframe(sessionId, {
                mode: 'iframe',
                height: '600px'
            });
        }

        function embedNoPreview() {
            clearContainer();
            const sessionId = "f512e1e4-9119-4b6e-a55e-5f3c40b1ae25"
            currentInstance = agp.initIframe(sessionId, {
                mode: 'iframe',
                parentElement: '#agp-container',
                noPreview: true,
                height: '500px',
                onMessage: (data, origin, iframe) => {
                    console.log('Sign-only iframe message:', data);
                }
            });
        }

        function clearContainer() {
            const container = document.getElementById('agp-container');
            container.innerHTML = '<p>Container for AGP iframe - click "Embed in Container" to load</p>';
            if (currentInstance && currentInstance.destroy) {
                currentInstance.destroy();
                currentInstance = null;
            }
        }

        function destroyAll() {
            agp.destroyAll();
            clearContainer();
            clearEmbeddedExamples();
            currentInstance = null;
        }

        function createCompactSignature() {
            // Clear any existing content in the compact widget
            const widget = document.getElementById('compact-widget');
            const existingIframe = widget.querySelector('iframe');
            if (existingIframe) {
                existingIframe.remove();
            }

            const sessionId = "f512e1e4-9119-4b6e-a55e-5f3c40b1ae25"
            agp.initIframe(sessionId, {
                mode: 'iframe',
                parentElement: '#compact-widget',
                noPreview: true,
                width: '100%',
                height: '120px',
                border: '1px solid #ddd',
                onMessage: (data, origin, iframe) => {
                    console.log('Compact signature widget message:', data);
                }
            });
        }

        function createInlinePreview() {
            // Clear any existing content in the inline preview widget
            const widget = document.getElementById('inline-preview');
            const existingIframe = widget.querySelector('iframe');
            if (existingIframe) {
                existingIframe.remove();
            }

            const sessionId = "f512e1e4-9119-4b6e-a55e-5f3c40b1ae25"
            agp.initIframe(sessionId, {
                mode: 'iframe',
                parentElement: '#inline-preview',
                noPreview: false,
                width: '100%',
                height: '350px',
                border: '1px solid #ddd',
                onMessage: (data, origin, iframe) => {
                    console.log('Inline preview widget message:', data);
                }
            });
        }

        function clearEmbeddedExamples() {
            const compactWidget = document.getElementById('compact-widget');
            const inlineWidget = document.getElementById('inline-preview');
            
            // Remove existing iframes and restore original content
            const compactIframe = compactWidget.querySelector('iframe');
            if (compactIframe) compactIframe.remove();
            
            const inlineIframe = inlineWidget.querySelector('iframe');
            if (inlineIframe) inlineIframe.remove();
        }

        // Example of handling messages globally
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'agp-custom-event') {
                console.log('Received custom AGP event:', event.data);
            }
        });
    </script>
</body>
</html>