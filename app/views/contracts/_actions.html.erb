<%
  # Configuration options:
  # - previous_page: Path for the back button

  previous_page = local_assigns.fetch(:previous_page, root_path)
%>

<%= turbo_frame_tag "contract_actions_#{@contract.uuid}" do %>
  <div class="w-full" data-controller="radio-link" data-action="change->radio-link#updateLink">
    <div class="mb-6 text-center lg:text-left">
      <h3 class="text-lg font-semibold text-gray-900 mb-2"><%= t('documents.new.actions.header') %></h3>
    </div>
    <div class="space-y-3">
      <%= render 'shared/radio_button_card',
            name: 'document_action',
            value: 'sign',
            label: t('documents.new.actions.sign.title'),
            description: t('documents.new.actions.sign.subtitle'),
            checked: true,
            data_attributes: { 
              url: signature_parameters_contract_path(@contract, target_step: 'sign')
            } %>

      <% if current_user&.signature_request_allowed? && @contract.bundle.nil? %>
        <%= render 'shared/radio_button_card',
              name: 'document_action',
              value: 'request_signature',
              label: t('documents.new.actions.request_signature.title'),
              description: t('documents.new.actions.request_signature.subtitle'),
              checked: false,
              data_attributes: { 
                url: signature_parameters_contract_path(@contract, target_step: 'request_signature')
              } %>
      <% end %>

      <% if current_user&.signature_extension_allowed? && @contract.extendable_signatures? %>
        <%= render 'shared/radio_button_card',
              name: 'document_action',
              value: 'add_timestamp',
              label: t('documents.new.actions.add_timestamp.title'),
              description: t('documents.new.actions.add_timestamp.subtitle'),
              checked: false,
              data_attributes: { 
                url: signature_extension_contract_path(@contract)
              } %>
      <% end %>
    </div>
    <div class="py-8">
      <div class="flex flex-col sm:flex-row gap-8">
        <%= link_to contract_path(@contract), class: "flex-1 inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", data: {turbo_frame: "_top"} do %>
          <%= t('documents.new.actions.back') %>
        <% end %>
        <%= link_to signature_parameters_contract_path(@contract, target_step: 'sign'),
              class: "flex-1 inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",
              data: { 
                turbo_frame: "_self",
                "radio-link-target": "link"
              } do %>
          <%= t('documents.new.actions.continue') %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
