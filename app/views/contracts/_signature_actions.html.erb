<%# locals: (info_hidden: false, no_preview: false, contract:) %>

<% content_for :head do %>
  <script src="<%= asset_path('autogram-sdk.js') %>"></script>
<% end %>

<div id="signature_actions_<%= contract.uuid %>" 
      data-controller="signature-method-selector"
      class="w-full">
  <div class="mb-4">
    <div>
      <h3 class="text-lg font-semibold text-gray-900 mb-4">
        <% if contract.awaiting_signature? %>
          <%= t('contracts.signature_actions.select_signing_app') %>
        <% else %>
          <%= t('contracts.signature_actions.add_another_signature') %>
        <% end %>
      </h3>
      <div class="space-y-3">
        <div data-signature-method-selector-target="desktopElement">
          <%= render 'shared/radio_button_card',
                name: "signature_method_#{contract.uuid}",
                value: 'autogram',
                label: t('contracts.signature_actions.autogram_desktop_label'),
                description: t('contracts.signature_actions.autogram_desktop_description'),
                checked: true,
                icon: 'desktop',
                wrapper_class: 'desktop-signing-element',
                data_attributes: { 
                  signature_method_selector_target: 'methodRadio'
                } %>
        </div>

        <%= render 'shared/radio_button_card',
              name: "signature_method_#{contract.uuid}",
              value: 'avm',
              label: t('contracts.signature_actions.autogram_mobile_label'),
              description: t('contracts.signature_actions.autogram_mobile_description'),
              checked: false,
              icon: 'mobile',
              data_attributes: { 
                signature_method_selector_target: 'methodRadio'
              } %>

        <%= render 'shared/radio_button_card',
              name: "signature_method_#{contract.uuid}",
              value: 'eidentita',
              label: t('contracts.signature_actions.eidentita_label'),
              description: t('contracts.signature_actions.eidentita_description'),
              checked: false,
              icon: 'mobile',
              data_attributes: { 
                signature_method_selector_target: 'methodRadio'
              } %>
      </div>
    </div>
  </div>

  <div class="space-y-3" data-signature-method-selector-target="buttonContainer">
    <div data-signature-method-selector-target="autogramForm"
        class="hidden">
      <%= form_with url: sign_contract_path(contract), 
                    method: :post, 
                    class: "w-full",
                    data: { 
                      controller: "signers--autogram-signer",
                      "signers--autogram-signer-contract-param-value": contract_path(contract),
                      "signers--autogram-signer-contract-uuid-value": contract.uuid,
                      "signers--autogram-signer-no-preview-value": no_preview,
                      "signers--autogram-signer-target": "form",
                      action: "submit->signers--autogram-signer#sign"
                    } do |form| %>
        <% if no_preview %>
          <%= form.hidden_field :no_preview, value: "1" %>
        <% end %>
        <button type="submit" 
                data-signers--autogram-signer-target="submitButton"
                style="display: none;">
        </button>
      <% end %>
    </div>

    <div data-signature-method-selector-target="avmForm" 
        class="hidden">
      <%= form_with url: sign_avm_contract_path(contract), 
                    method: :post, 
                    class: "w-full",
                    local: false,
                    data: { 
                      controller: "signers--avm-signer",
                      "signers--avm-signer-target": "form",
                      action: "submit->signers--avm-signer#sign"
                    } do |form| %>
        <% if no_preview %>
          <%= form.hidden_field :no_preview, value: "1" %>
        <% end %>
        <button type="submit" 
                data-signers--avm-signer-target="submitButton"
                style="display: none;">
        </button>
      <% end %>
    </div>

    <div data-signature-method-selector-target="eidentitaForm" 
        class="hidden">
      <%= form_with url: sign_eidentita_contract_path(contract), 
                    method: :post, 
                    class: "w-full",
                    local: false,
                    data: { 
                      controller: "signers--eidentita-signer",
                      "signers--eidentita-signer-target": "form",
                      action: "submit->signers--eidentita-signer#sign"
                    } do |form| %>
        <% if no_preview %>
          <%= form.hidden_field :no_preview, value: "1" %>
        <% end %>
        <button type="submit" 
                data-signers--eidentita-signer-target="submitButton"
                style="display: none;">
        </button>
      <% end %>
    </div>

    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="ml-3 flex-1">
          <h4 class="text-sm font-semibold text-blue-900 mb-1"><%= t('contracts.signature_actions.first_time_signing') %></h4>
          <p class="text-sm text-blue-800">
            <%= t('contracts.signature_actions.learn_more_text') %> â†’ 
            <%= link_to t('contracts.signature_actions.how_signing_works'), "#", class: "font-medium underline hover:text-blue-600" %>
          </p>
        </div>
      </div>
    </div>

    <div class="my-6 border-b border-gray-200"></div>

    <div class="flex gap-4">
      <%= link_to root_path, class: "flex-1 inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" do %>
        <%= t('contracts.signature_actions.cancel') %>
      <% end %>

      <button type="button"
              data-signature-method-selector-target="signButton"
              data-action="click->signature-method-selector#triggerSign"
              class="flex-1 inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
        <%= t('contracts.signature_actions.continue_to_sign') %>
      </button>
    </div>
  </div>
</div>
