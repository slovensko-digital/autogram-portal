<%= turbo_stream_from "contract_#{@contract.uuid}" %>

<main>
  <div class="relative isolate overflow-hidden">
    <div class="mx-auto max-w-7xl px-6 pb-8 pt-10 lg:flex lg:px-8">
      <div class="mx-auto flex max-w-full sm:max-w-3xl lg:ml-10 lg:mr-0 lg:max-w-none lg:flex-none xl:ml-32">
        <div class="flex flex-col items-center max-w-full sm:max-w-3xl mx-auto lg:max-w-none w-[1000px]">
          <div class="w-full mb-6">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4">
              <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Edit Contract</h1>
                <p class="mt-2 text-sm text-gray-500">UUID: <%= @contract.uuid %></p>
              </div>
            </div>
          </div>

          <%= form_with model: @contract, url: contract_path(@contract), method: :patch, local: true, class: "w-full" do |form| %>
            <div class="space-y-6">
              <div class="bg-white border border-gray-200 rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                  <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Signature Parameters</h3>
                    <p class="text-gray-600">Configure signature format and allowed signature methods for this contract.</p>
                  </div>

                  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <%= form.fields_for :signature_parameters do |sp_form| %>
                      <div>
                        <%= sp_form.label :format_container_combination, "Signature Format", class: "block text-sm font-medium text-gray-700 mb-3" %>
                        <div class="space-y-3">
                          <%# TODO: edit this when multiple documents are supported %>
                          <% signature_options = @contract.documents.first.signature_options %>
                          <% signature_options.each do |label, value, description| %>
                          <%= render 'shared/radio_button_card', 
                                form: sp_form,
                                name: :format_container_combination,
                                value: value,
                                label: label,
                                description: description,
                                checked: value == @contract.signature_parameters.format_container_combination %>
                          <% end %>
                        </div>
                      </div>
                    <% end %>

                    <div>
                      <%= label_tag "allowed_methods", "Signature Method", class: "block text-sm font-medium text-gray-700 mb-3" %>
                      <div class="space-y-3">
                        <% [
                          ['QES', 'qes', 'Qualified Electronic Signature'],
                          ['QES + Timestamp', 'ts-qes', 'Qualified Electronic Signature with Timestamp']
                        ].each do |label, value, description| %>
                          <%= render 'shared/radio_button_card', 
                                name: 'contract[allowed_methods][]',
                                value: value,
                                label: label,
                                description: description,
                                checked: @contract.allowed_methods.include?(value) %>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-white border border-gray-200 rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                  <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Documents</h3>
                    <p class="text-gray-600">Documents associated with this contract.</p>
                  </div>

                  <div class="space-y-4">
                    <% @contract.documents.each do |document| %>
                      <div class="flex items-center p-4 bg-gray-50 border border-gray-200 rounded-lg">
                        <div class="flex items-center space-x-3 flex-1 min-w-0">
                          <svg class="h-8 w-8 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                          </svg>
                          <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900 truncate"><%= document.filename %></p>
                            <p class="text-xs text-gray-500">UUID: <%= document.short_uuid %></p>
                          </div>
                        </div>
                      </div>
                    <% end %>

                    <% if @contract.documents.empty? %>
                      <div class="text-center py-6">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                        </svg>
                        <p class="mt-2 text-sm text-gray-500">No documents associated with this contract.</p>
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>

              <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3">
                <%= link_to contract_path(@contract), 
                           data: { 
                             turbo_method: :delete,
                             turbo_confirm: "Are you sure you want to delete this contract? This action is irreversible and will also remove all documents associated with this contract."
                           },
                           class: "inline-flex items-center justify-center px-3 py-2 border border-red-300 text-sm leading-4 font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" do %>
                  <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                  </svg>
                  Destroy contract
                <% end %>
                <div class="flex flex-col sm:flex-row gap-3">
                  <%= link_to "Cancel", contract_path(@contract), class: "inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
                  <%= form.submit "Update Contract", class: "inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</main>

<% content_for :title, "Edit Contract ##{@contract.short_uuid}" %>
